## 进程管理

### 进程管理作用

* 判断服务器健康状态
* 查看系统中所有的进程
* 杀死进程，建议优先使用正确的关闭命令来停止服务


### 查看进程

#### ps
~~~
ps
    a   显示一个终端的所有进程，除了会话引线
    u   显示进程的归属用户及内存的使用情况
    x   显示没有控制终端的进程
    -l  长格式显示，显示更加详细的信息
    -e  显示所有进程，和 -A 作用一致
~~~
例：查看系统中所有的进程
~~~
[root@localhost ~]# ps aux

USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0 193756  6812 ?        Ss   9月23   0:13 /usr/lib/systemd/systemd --switched-root --system --deserialize 21
root         2  0.0  0.0      0     0 ?        S    9月23   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        S    9月23   0:26 [ksoftirqd/0]
root         5  0.0  0.0      0     0 ?        S<   9月23   0:00 [kworker/0:0H]
root         7  0.0  0.0      0     0 ?        S    9月23   0:13 [migration/0]
...

USER    该进程是由哪个用户产生的
PID     进程的ID号
%CPU    该进程占用CPU资源的百分比，占用越高，进程越耗费资源
%MEN    该进程占用物理内存的百分比，占用越高，进程越耗费资源
VSZ     该进程占用虚拟内存的大小，单位KB
RSS     该进程占用实际物理内存的大小
TTY     该进程是在哪个终端中运行的，其中tty1-tty7 代表本地控制台终端(可以通过alt+F1-F7键切换不同的终端)，tty1-tty6 是本地的字符界面终端，tty7是图形终端。pst/0-255 代表虚拟终端，第一个远程连接占用的是 pst/0 终端，第二个远程连接占用 pst/1，依次增长
STAT    进程状态,常见状态如下：
    D       不可被唤醒的睡眠状态，通常用于I/O情况
    R       该进程正在运行
    S       该进程在睡眠状态，可被唤醒
    T       停止状态，可能是在后台暂停或进程在除错状态
    W       内存监护状态(从 2.6 内核开始无效)
    X       死掉的进程(-应该不会出现)
    Z       僵尸进程，进程已经停止，但是部分内存还在内存中
    <       高优先级(以下状态在BSD格式当中出现)
    N       低优先级
    L       被锁入内存
    s       包含子进程
    l       多线程(小写L)
    +       位于后台

START   该进程是启动时间
TIME    该进程占用CPU的运算时间，注意不是系统时间
COMMAND 产生此进程的命令名
~~~

例：查看系统中所有的进程，包括进程的父进程的 PID 和进程优先级
~~~
[root@localhost ~]# ps -le

F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
4 S     0     1     0  0  80   0 - 48439 ep_pol ?        00:00:13 systemd
1 S     0     2     0  0  80   0 -     0 kthrea ?        00:00:00 kthreadd
1 S     0     3     2  0  80   0 -     0 smpboo ?        00:00:27 ksoftirqd/0
...

F       进程标志，说明进程的权限，常见的标志有：
    1       进程可以复制，但是不能执行
    4       进程使用超级用户权限

S       进程状态，具体的状态和 ps aux 命令中的STAT状态一致
UID     进程是哪个 UID 用户调用运行的
PID     进程的 ID 号
PPID    进程的父 ID 号
C       该进程的CPU使用了，单位是百分比
PRI     进程的优先级，数值越小该进程优先级越高，越快被CPU执行,动态值
NI      进程的优先级，数值越小该进程优先级越高，越快被CPU执行,静态值
ADDR    该进程在内存的哪个位置
SZ      该内存占用多大内存
WCHAN   该进程是否运行， - 代表正在运行
TTY     该进程由哪个终端产生
TIME    该进程占用CPU的运算时间
CMD     产生此进程的命令名
~~~

#### top

实时交互监测系统资源使用状况，包含，进程、cpu，内存等。

~~~
top [选项]
    -d 秒数     指定top命令每隔几秒更新，默认是3秒
    -b          使用批处理模式输出，一般和 -n 选项何用，用于把top 命令重定向到文件中
    -n 次数     指定top命令执行的次数，一般和 -b 选项合用
    -p          指定PID，只查看某个PID的进程
    -s          使top在安全模式运行，避免在交互模式中出现错误
    -u 用户名   只监听某个用户的进程

在top命令的交互模式当中可以执行的命令：
    ?   显示交互模式的帮助moug
    h   同?,显示交互模式的帮助
    P   以CPU使用率排序，默认就是此选项
    M   以内存的使用率排序
    N   以PID排序
    T   按照CPU的累计运算时间排序，也就是用TIME+项排序
    k   按照PID号，给予某个进程一个信号，一般用于终止某个进程
    r   按照PID号，给某个进程重设优先级(Nice)值
    q   退出top
~~~

例：用top查看进程
~~~
[root@localhost ~]# top

top - 16:41:57 up 7 days,  3:27,  2 users,  load average: 0.04, 0.13, 0.19
Tasks: 133 total,   2 running, 131 sleeping,   0 stopped,   0 zombie
%Cpu(s):  6.5 us,  3.5 sy,  0.0 ni, 89.8 id,  0.0 wa,  0.0 hi,  0.2 si,  0.0 st
KiB Mem :  7877424 total,   502240 free,   838492 used,  6536692 buff/cache
KiB Swap:        0 total,        0 free,        0 used.  6320636 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                        
 2032 root      20   0  121848   7968   1288 S   2.7  0.1 209:04.31 phdaemon                                                                                       
30817 root      20   0  137628  19280   6156 S   0.7  0.2  71:51.86 gitlab-runner                                                                                  
 2031 root      20   0  265436   2872   2132 S   0.3  0.0   9:26.47 oraynewph                                                                                      
17576 root      20   0  141660   5668   4204 S   0.3  0.1   1:36.72 sshd                                                                                           
    1 root      20   0  193756   6812   4028 S   0.0  0.1   0:13.79 systemd       

第一部分：
16:41:57                        系统当前时间
up 7 days, 3:27                 系统运行时间，此例子运行了7天3小时27分钟
2 users                         当前登陆的用户数，此例当前登陆了2个用户
load average: 0.04, 0.13, 0.19  系统在之前1分钟，5分钟，15分钟的平均负载

Tasks: 
133 total           系统中进程总数
2 running           正在运行的进程数
131 sleeping        睡眠的进程
0 stopped           正在停止的进程
0 zombie            僵尸进程，如果不是0，一般需要手动检查僵尸进程

%Cpu(s):  
6.5 us              用户模式占用的CPU百分比
3.5 sy              系统模式占用的CPU百分比           
0.0 ni              改变过优先级的用户进程占用的CPU百分比
89.8 id             空闲CPU的CPU百分比
0.0 wa              等待输入/输出的进程的占用CPU的百分比
0.0 hi              硬中断请求服务占用的CPU百分比
0.2 si              软中断请求额服务占用的CPU百分比
0.0 st              虚拟时间百分比，就是当有虚拟机时，虚拟CPU等待实际CPU的时间百分比

KiB Mem : 
7877424 total
502240 free
838492 used
6536692 buff/cache


~~~

#### pstree









### 结束进程

#### kill

#### killall

#### pkill

~~~
pkill 
~~~

###


## 122



















